function getHost(t){var e;return e=t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0],e=e.split(":")[0]}function setItem(t,e){window.localStorage.removeItem(t),window.localStorage.setItem(t,e)}function getItem(t){var e;try{e=window.localStorage.getItem(t)}catch(o){e="null"}return e}function showFlag(t,e){chrome.pageAction.setIcon({tabId:t,path:"../../img/flags/"+currentCodeList[e]+".png"}),chrome.pageAction.show(t),chrome.pageAction.setTitle({tabId:t,title:currentCountryList[e]+"\n"+e+"\n"+currentIPList[e]})}function fileExists(t){try{var e=new XMLHttpRequest;return e.open("HEAD",t,!1),e.send(),!0}catch(o){return!1}}var currentIPList={},currentCountryList={},currentCodeList={};chrome.extension.onMessage.addListener(function(t,e,o){switch(t.type){case"getIP":var r=t.url;o(void 0!==currentIPList[getHost(r)]?{domainToIP:currentIPList[getHost(r)],domainToCountry:currentCountryList[getHost(r)],domainToCode:currentCodeList[getHost(r)]}:{domainToIP:"Unknown",domainToCountry:"Unknown"});break;default:o({})}}),chrome.webRequest.onResponseStarted.addListener(function(t){var e=t.ip,o=getHost(t.url);if(ipaddr.isValid(e)&&e!==currentIPList[o]){if(currentIPList[o]=e,ipaddr.IPv4.isValid(e))var r="GeoLite2-Country-Blocks-IPv4.csv";else var r="GeoLite2-Country-Blocks-IPv6.csv";var n=Papa.parse("../../geolite2/"+r,{header:!0,download:!0,worker:!0,skipEmptyLines:!0,complete:function(r){var n=ipaddr.parse(e);r.data.forEach(function(e){var r=e.network.split("/"),i=ipaddr.parse(r[0]);if(n.match(i,r[1])){var a=e.geoname_id,s=chrome.i18n.getUILanguage().replace("_","-");if(fileExists("../../geolite2/GeoLite2-Country-Locations-"+s+".csv"))var c=s;else var c="en";var u=Papa.parse("../../geolite2/GeoLite2-Country-Locations-"+c+".csv",{header:!0,download:!0,worker:!0,skipEmptyLines:!0,complete:function(e){e.data.forEach(function(e){e.geoname_id===a&&(e.country_iso_code?(currentCodeList[o]=e.country_iso_code.toLowerCase(),currentCountryList[o]=e.country_name):(currentCodeList[o]=e.continent_code.toLowerCase(),currentCountryList[o]=e.continent_name),showFlag(t.tabId,o))})}})}})}})}},{urls:["<all_urls>"],types:["main_frame"]},[]),chrome.tabs.onUpdated.addListener(function(t,e,o){chrome.runtime.lastError||"undefined"==typeof currentCodeList[getHost(o.url)]||showFlag(t,getHost(o.url))});